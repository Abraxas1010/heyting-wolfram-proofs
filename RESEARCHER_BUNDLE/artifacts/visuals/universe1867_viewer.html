<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Universe 1867: Wolfram → Lean Bridge</title>
  <style>
    :root {
      --bg: #000000;
      --card: #0a0a0a;
      --border: rgba(255,255,255,0.1);
      --text: #fafafa;
      --dim: #9ca3af;
      --accent: #60a5fa;
      --wolfram: #dd4a22;
      --lean: #3b82f6;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      min-height: 100vh;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 8px;
      font-size: 24px;
    }
    h1 .wolfram { color: var(--wolfram); }
    h1 .lean { color: var(--lean); }
    h1 .arrow { color: var(--dim); margin: 0 8px; }
    .subtitle {
      text-align: center;
      color: var(--dim);
      font-size: 12px;
      margin-bottom: 24px;
    }
    .subtitle a { color: var(--accent); }

    .stats-bar {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-bottom: 24px;
      padding: 16px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 8px;
    }
    .stat {
      text-align: center;
    }
    .stat-value {
      font-size: 28px;
      font-weight: 700;
      color: var(--accent);
    }
    .stat-label {
      font-size: 11px;
      color: var(--dim);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .main-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 24px;
    }

    .panel {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
    }
    .panel-header {
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .panel-header.wolfram { border-left: 3px solid var(--wolfram); }
    .panel-header.lean { border-left: 3px solid var(--lean); }
    .panel-header h3 {
      font-size: 14px;
      font-weight: 600;
    }
    .panel-header .badge {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 4px;
      background: rgba(255,255,255,0.1);
    }
    .panel-content {
      padding: 16px;
    }
    .panel-content img {
      width: 100%;
      border-radius: 4px;
    }

    .code-block {
      background: #111;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 12px;
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
      font-size: 10px;
      line-height: 1.5;
      overflow-x: auto;
      white-space: pre;
    }
    .code-block .comment { color: #6b7280; }
    .code-block .keyword { color: #c084fc; }
    .code-block .string { color: #fbbf24; }
    .code-block .type { color: #34d399; }
    .code-block .number { color: #60a5fa; }

    .evolution-strip {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
    }
    .evolution-strip h3 {
      font-size: 14px;
      margin-bottom: 12px;
    }
    .frames {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 8px;
    }
    .frame {
      flex-shrink: 0;
      width: 120px;
      text-align: center;
    }
    .frame img {
      width: 100%;
      border-radius: 4px;
      border: 1px solid var(--border);
    }
    .frame-label {
      font-size: 10px;
      color: var(--dim);
      margin-top: 4px;
    }

    .theorem-box {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 6px;
      padding: 12px;
      margin-top: 12px;
    }
    .theorem-box h4 {
      font-size: 12px;
      color: var(--lean);
      margin-bottom: 8px;
    }

    .back-link {
      display: inline-block;
      color: var(--dim);
      font-size: 12px;
      text-decoration: none;
      margin-bottom: 16px;
    }
    .back-link:hover { color: var(--accent); }

    .rule-display {
      background: rgba(221, 74, 34, 0.1);
      border: 1px solid rgba(221, 74, 34, 0.3);
      border-radius: 6px;
      padding: 16px;
      text-align: center;
      margin-bottom: 12px;
    }
    .rule-display .rule {
      font-family: 'JetBrains Mono', monospace;
      font-size: 14px;
      color: var(--wolfram);
    }
    .rule-display .label {
      font-size: 10px;
      color: var(--dim);
      margin-top: 6px;
    }

    /* 3D Viewer */
    .viewer-3d {
      width: 100%;
      height: 400px;
      border-radius: 4px;
      position: relative;
    }
    .viewer-3d canvas {
      border-radius: 4px;
    }
    .viewer-controls {
      position: absolute;
      bottom: 10px;
      right: 10px;
      display: flex;
      gap: 6px;
    }
    .viewer-controls button {
      padding: 6px 10px;
      background: rgba(0,0,0,0.7);
      border: 1px solid var(--border);
      border-radius: 4px;
      color: var(--text);
      font-size: 10px;
      cursor: pointer;
    }
    .viewer-controls button:hover {
      background: rgba(96,165,250,0.3);
    }
  </style>
</head>
<body>
  <a href="index.html" class="back-link">← Back to Visualizations</a>

  <h1>
    <span class="wolfram">Wolfram Physics</span>
    <span class="arrow">→</span>
    <span class="lean">Lean 4</span>
  </h1>
  <p class="subtitle">
    Universe 1867 from the <a href="https://www.wolframphysics.org/universes/wm1867/" target="_blank">Registry of Notable Universes</a>
  </p>

  <div class="stats-bar">
    <div class="stat">
      <div class="stat-value">7</div>
      <div class="stat-label">Generations</div>
    </div>
    <div class="stat">
      <div class="stat-value">74</div>
      <div class="stat-label">Events</div>
    </div>
    <div class="stat">
      <div class="stat-value">150</div>
      <div class="stat-label">Final Edges</div>
    </div>
    <div class="stat">
      <div class="stat-value">75</div>
      <div class="stat-label">Vertices</div>
    </div>
  </div>

  <div class="main-grid">
    <!-- Wolfram Side -->
    <div class="panel">
      <div class="panel-header wolfram">
        <h3>Wolfram Language</h3>
        <span class="badge">Source</span>
      </div>
      <div class="panel-content">
        <div class="rule-display">
          <div class="rule">{{{1,2},{2,3}} → {{2,3},{2,3},{3,4},{1,3}}}</div>
          <div class="label">Universe 1867 Rewriting Rule</div>
        </div>
        <div class="code-block"><span class="comment">(* Downloaded from wolframphysics.org *)</span>
<span class="keyword">WolframModel</span>[
  {{{<span class="number">1</span>,<span class="number">2</span>},{<span class="number">2</span>,<span class="number">3</span>}} -> {{<span class="number">2</span>,<span class="number">3</span>},{<span class="number">2</span>,<span class="number">3</span>},{<span class="number">3</span>,<span class="number">4</span>},{<span class="number">1</span>,<span class="number">3</span>}}},
  {{<span class="number">1</span>,<span class="number">1</span>},{<span class="number">1</span>,<span class="number">1</span>}},  <span class="comment">(* 2 self-loops *)</span>
  <span class="number">7</span>               <span class="comment">(* 7 generations *)</span>
]</div>
        <img src="universe1867_graph.png" alt="Universe 1867 Graph" style="margin-top: 12px;">
      </div>
    </div>

    <!-- Lean Side -->
    <div class="panel">
      <div class="panel-header lean">
        <h3>Lean 4 Formalization</h3>
        <span class="badge">Verified</span>
      </div>
      <div class="panel-content">
        <div class="code-block"><span class="comment">-- Parallel WolframModel semantics</span>
<span class="keyword">def</span> applyRule (e1 e2 : <span class="type">Hyperedge</span>) (fresh : <span class="type">Nat</span>) :
    <span class="type">List Hyperedge</span> :=
  <span class="keyword">let</span> a := e1.src; <span class="keyword">let</span> b := e1.tgt; <span class="keyword">let</span> c := e2.tgt
  [⟨b,c⟩, ⟨b,c⟩, ⟨c,fresh⟩, ⟨a,c⟩]

<span class="comment">-- Find ALL matches, apply non-overlapping</span>
<span class="keyword">def</span> stepGeneration (g : <span class="type">Hypergraph</span>) :
    <span class="type">Hypergraph × Nat</span> := ...

<span class="keyword">def</span> evolveGenerations (g : <span class="type">Hypergraph</span>) (n : <span class="type">Nat</span>) :
    <span class="type">Hypergraph × Nat</span> := ...</div>

        <div class="theorem-box">
          <h4>Verified Theorems</h4>
          <div class="code-block"><span class="keyword">theorem</span> initial_edge_count :
    edgeCount initial = <span class="number">2</span> := <span class="keyword">rfl</span>

<span class="keyword">theorem</span> rule_produces_four_edges :
    (applyRule e1 e2 fresh).length = <span class="number">4</span> := <span class="keyword">rfl</span>

<span class="keyword">theorem</span> self_loops_match :
    (findAllMatches initial).length > <span class="number">0</span> := <span class="keyword">by</span> native_decide

<span class="comment">-- #eval universe1867_gen7</span>
<span class="comment">-- Result: (150 edges, 74 events, 75 vertices)</span></div>
        </div>
      </div>
    </div>
  </div>

  <div class="evolution-strip">
    <h3>Evolution: 7 Generations (74 Events)</h3>
    <div class="frames">
      <div class="frame">
        <img src="frame_0.png" alt="Step 0">
        <div class="frame-label">Gen 0: 2 edges</div>
      </div>
      <div class="frame">
        <img src="frame_1.png" alt="Step 1">
        <div class="frame-label">Gen 1</div>
      </div>
      <div class="frame">
        <img src="frame_2.png" alt="Step 2">
        <div class="frame-label">Gen 2</div>
      </div>
      <div class="frame">
        <img src="frame_3.png" alt="Step 3">
        <div class="frame-label">Gen 3</div>
      </div>
      <div class="frame">
        <img src="frame_4.png" alt="Step 4">
        <div class="frame-label">Gen 4</div>
      </div>
      <div class="frame">
        <img src="frame_5.png" alt="Step 5">
        <div class="frame-label">Gen 5</div>
      </div>
      <div class="frame">
        <img src="frame_6.png" alt="Step 6">
        <div class="frame-label">Gen 6</div>
      </div>
      <div class="frame">
        <img src="frame_7.png" alt="Step 7">
        <div class="frame-label">Gen 7: 150 edges</div>
      </div>
    </div>
  </div>

  <div class="main-grid">
    <div class="panel">
      <div class="panel-header wolfram">
        <h3>Interactive 3D View</h3>
      </div>
      <div class="panel-content">
        <div class="viewer-3d" id="viewer3d">
          <div class="viewer-controls">
            <button onclick="resetCamera3D()">Reset</button>
            <button onclick="toggleSpin3D()">Spin</button>
          </div>
        </div>
      </div>
    </div>
    <div class="panel">
      <div class="panel-header lean">
        <h3>Bridge Protocol</h3>
      </div>
      <div class="panel-content">
        <div class="code-block"><span class="comment">-- Binary format (Int64 LE)</span>
universe1867_hypergraph.bin  <span class="comment">-- 2400 bytes</span>
universe1867_lengths.bin     <span class="comment">-- 1200 bytes</span>
universe1867_edges.json      <span class="comment">-- JS array</span>

<span class="comment">-- Reconstruction:</span>
data = BinaryReadList[path, <span class="string">"Integer64"</span>]
lengths = BinaryReadList[lpath, <span class="string">"Integer64"</span>]
hypergraph = TakeList[data, lengths]

<span class="comment">-- Lean verification:</span>
<span class="keyword">def</span> toBridgeFormat (g : <span class="type">Hypergraph</span>) :
    <span class="type">List (List Nat)</span> :=
  g.map <span class="keyword">fun</span> e => [e.src, e.tgt]</div>
        <p style="font-size: 11px; color: var(--dim); margin-top: 12px;">
          The bridge protocol enables lossless roundtrip between
          Wolfram and Lean representations.
        </p>
      </div>
    </div>
  </div>

  <div style="text-align: center; margin-top: 24px; padding: 16px; border-top: 1px solid var(--border);">
    <p style="font-size: 11px; color: var(--dim);">
      Source: <a href="https://www.wolframphysics.org/universes/wm1867/" style="color: var(--accent);">wolframphysics.org/universes/wm1867</a>
      · Lean: <code style="background: #111; padding: 2px 6px; border-radius: 3px;">HeytingLean.WolframPhysics.Universe1867</code>
    </p>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <script>
    // Universe 1867 edge data (loaded dynamically from universe1867_edges.json)
    let edges = [];

    let scene3D, camera3D, renderer3D, controls3D;
    let graphGroup;
    let spinning3D = false;

    function init3D() {
      const container = document.getElementById('viewer3d');
      const width = container.clientWidth;
      const height = 400;

      scene3D = new THREE.Scene();
      scene3D.background = new THREE.Color(0x050505);

      camera3D = new THREE.PerspectiveCamera(60, width / height, 0.1, 1000);
      camera3D.position.set(8, 6, 10);

      renderer3D = new THREE.WebGLRenderer({ antialias: true });
      renderer3D.setSize(width, height);
      renderer3D.setPixelRatio(window.devicePixelRatio);
      container.insertBefore(renderer3D.domElement, container.firstChild);

      controls3D = new THREE.OrbitControls(camera3D, renderer3D.domElement);
      controls3D.enableDamping = true;
      controls3D.dampingFactor = 0.05;

      // Lighting
      scene3D.add(new THREE.AmbientLight(0xffffff, 0.5));
      const dir = new THREE.DirectionalLight(0xffffff, 0.8);
      dir.position.set(5, 10, 7);
      scene3D.add(dir);

      createGraph3D();
      animate3D();
    }

    function createGraph3D() {
      graphGroup = new THREE.Group();

      // Get unique vertices and create positions
      const vertices = new Set();
      edges.forEach(e => { vertices.add(e[0]); vertices.add(e[1]); });
      const vertexArray = Array.from(vertices).sort((a,b) => a-b);

      // Spherical layout
      const positions = {};
      vertexArray.forEach((v, i) => {
        const phi = Math.acos(-1 + (2 * i) / vertexArray.length);
        const theta = Math.sqrt(vertexArray.length * Math.PI) * phi;
        const r = 5;
        positions[v] = [
          r * Math.cos(theta) * Math.sin(phi),
          r * Math.sin(theta) * Math.sin(phi),
          r * Math.cos(phi)
        ];
      });

      // Draw edges
      edges.forEach(([src, tgt]) => {
        const p1 = positions[src];
        const p2 = positions[tgt];
        if (p1 && p2) {
          const path = new THREE.LineCurve3(
            new THREE.Vector3(...p1),
            new THREE.Vector3(...p2)
          );
          const tube = new THREE.TubeGeometry(path, 1, 0.02, 6, false);
          const mat = new THREE.MeshPhongMaterial({
            color: 0xff6633,
            transparent: true,
            opacity: 0.6
          });
          graphGroup.add(new THREE.Mesh(tube, mat));
        }
      });

      // Draw vertices
      vertexArray.forEach(v => {
        const pos = positions[v];
        const geom = new THREE.SphereGeometry(0.12, 12, 12);
        const mat = new THREE.MeshPhongMaterial({ color: 0x00ffff, shininess: 30 });
        const mesh = new THREE.Mesh(geom, mat);
        mesh.position.set(...pos);
        graphGroup.add(mesh);
      });

      scene3D.add(graphGroup);
    }

    function resetCamera3D() {
      camera3D.position.set(8, 6, 10);
      controls3D.target.set(0, 0, 0);
      controls3D.update();
    }

    function toggleSpin3D() {
      spinning3D = !spinning3D;
    }

    function animate3D() {
      requestAnimationFrame(animate3D);
      if (spinning3D && graphGroup) {
        graphGroup.rotation.y += 0.005;
      }
      controls3D.update();
      renderer3D.render(scene3D, camera3D);
    }

    // Load edge data and initialize
    async function loadAndInit() {
      try {
        const response = await fetch('universe1867_edges.json');
        edges = await response.json();
        init3D();
      } catch (e) {
        console.error('Failed to load edges:', e);
        // Fallback: show static image
        document.getElementById('viewer3d').innerHTML = '<img src="universe1867_3d.png" style="width:100%;border-radius:4px;">';
      }
    }
    window.addEventListener('load', loadAndInit);
  </script>
</body>
</html>
